---
title: "Tugas Pertemuan 4 MPDW"
author: "Varel Geo S.P"
date: "2025-09-22"
output:
  rmdformats::readthedown:
    highlight: kate
    number_sections: true
---

# LOAD LIBRARY

```{r}
library("forecast")
library("graphics")
library("TTR")
library("TSA")
library("aTSA")
library("lmtest")
library("MLmetrics")
library("car")
library("dplyr")
library("MASS")
library("tsibble")
library("tseries")
library("ggplot2")
library("nortest")
```

```{r}
library("readxl")
library("dplyr")
```

```{r}
library("dLagM")
```

```{r}
library(orcutt) #untuk membuat model regresi Cochrane-Orcutt
library(HoRM)
```

```{r}
library(MLmetrics) #untuk menghitung MAPE
library(dynlm)
library(lmtest)
```

# PROSES MA(2)

## Manual

```{r}
set.seed(1037)           # reproducibility
n <- 300                 # panjang data
white <- rnorm(n, mean=0, sd=1)  # white noise

```
```{r}
# MA(2) Manual
ma<-white[c(1,2)]

for(i in 3:300){
  ma[i]<-white[i]+0.4*white[i-1]+0.6*white[i-2]
}
ma <- ts(ma)
ma
```

## Arima.sim

```{r}
set.seed(1037)
ma2 <- arima.sim(list(order = c(0,0,2), ma = c(0.4, 0.6)), n = 300)
ma2
```

## Plot Time Series

```{r}
plot(ma, main="Simulasi MA(2) manual", ylab="Y_t")
```

## Plot ACF

```{r}
acf(ma)
```

## Plot PACF

```{r}
pacf(ma)
```

## Plot EACF

```{r}
TSA::eacf(ma)
```

## Scatter Plot Antar Lag

### Korelasi antara Yt dengan Y(t-1)

```{r}
#Yt
yt_ma <- ma[-1]
#Yt-1
yt_1_ma <- ma[-300]
plot(y=yt_ma,x=yt_1_ma)
```


### Korelasi antara Yt dengan Y(t-2)

```{r}
#Yt
yt_ma2 <- ma[-c(1,2)]
yt_2_ma <- ma[-c(299,300)]
plot(y=yt_ma2,x=yt_2_ma)
```


### Korelasi antara Yt dengan Y(t-3)

```{r}
#Yt
yt_ma3 <- ma[-c(1,2,3)]
yt_3_ma <- ma[-c(298,299,300)]
plot(y=yt_ma3,x=yt_3_ma)
```


## Aukokorelasi Data vs Teoritis

```{r}
cor(yt_ma,yt_1_ma)
```

```{r}
cor(yt_ma2,yt_2_ma)
```

```{r}
cor(yt_ma3,yt_3_ma)
```

$$
\rho_1 = \frac{-\theta_1 + \theta_1 \theta_2}{1 + (-\theta_1)^2 + (-\theta_2)^2}
= \frac{-(-0.4) + (-0.4)(-0.6)}{1 + (-0.4)^2 + (-0.6)^2} \approx 0.421
$$

$$
\rho_2 = \frac{-\theta_2}{1 + (-\theta_1)^2 + (-\theta_2)^2}
= \frac{-(-0.6)}{1 + (-0.4)^2 + (-0.6)^2} \approx 0.395
$$

$$
\rho_k = 0, \quad k > 2
$$


# PROSES AR(2)

## Manual

```{r}
set.seed(1037)
# AR(2) Manual
ar2<-numeric(300)
ar2[c(1,2)]<-1

for(i in 3:300){
  ar2[i]<-0.5*ar2[i-1]+0.2*ar2[i-2]+white[i]
}
ar2
```

## Arima.sim

```{r}
set.seed(1037)
ar2_sim <- arima.sim(list(order=c(2,0,0), ar=c(0.5, 0.2)), n=300)
ar2_sim
```

## Plot Time Series

```{r}
ts.plot(ar)
```

## Plot ACF

```{r}
acf(ar)
```

## Plot PACF

```{r}
pacf(ar)
```

## Plot EACF

```{r}
eacf(ar)
```

## Scatter Plot Antar Lag

### Korelasi antara Yt dengan Y(t-1)

```{r}
#Yt
yt_ar <- ar[-1]
#Yt-1
yt_1_ar <- ar[-300]
plot(y=yt_ar,x=yt_1_ar)
```

### Korelasi antara Yt dengan Y(t-2)

```{r}
#Yt
yt_ar2 <- ar[-c(1,2)]
#Yt-2
yt_2_ar <- ar[-c(299,300)]
plot(y=yt_ar2,x=yt_2_ar)
```

### Korelasi antara Yt deengan Y(t-3)

```{r}
#Yt
yt_ar3 <- ar[-c(1,2,3)]
#Yt-3
yt_3_ar <- ar[-c(298,299,300)]
plot(y=yt_ar3,x=yt_3_ar)
```

## Autokorelasi Data vs Teoritis

```{r}
cor(yt_ar,yt_1_ar)
```

```{r}
cor(yt_ar2,yt_2_ar)
```

```{r}
cor(yt_ar3,yt_3_ar)
```

Berikut adalah perhitungan autokorelasi:

$$
\rho_1 = \frac{\phi_1}{1-\phi_2} = \frac{0.5}{1-0.2} = 0.625
$$

$$
\rho_2 = \phi_1 \rho_1 + \phi_2 \rho_0 
= \frac{\phi_1^2 + \phi_2 (1-\phi_2)}{1-\phi_2}
= \frac{(0.5)^2 + 0.2(1-0.2)}{1-0.2} = 0.5125
$$

$$
\rho_3 = \phi_1 \rho_2 + \phi_2 \rho_1 + \phi_3 \rho_0 
= (0.5)(0.5125) + (0.2)(0.625) = 0.38125
$$

# PROSES ARMA (2,2)

## Manual

```{r}
# ARMA(2,2) Manual
set.seed(1037)
arma.sim <- function(n, macoef, arcoef){
  manum <- length(macoef)
  arnum <- length(arcoef)
  stopifnot(manum < n & arnum < n)
  
  wn <- rnorm(n, sd = 1)
  init <- max(manum, arnum)

  arma <- wn[1:init]
  for(i in {init+1}:n){
   mastart <- i - manum
   maend <- i-1
   arstart <- i - arnum
   arend <- i-1
   arma[i] <- sum(arcoef * arma[arstart:arend]) + sum(macoef * wn[mastart:maend])  + wn[i]
   }
  return(arma)
}
arma22 <- arma.sim(300, c(0.4,0.6), c(0.5,0.2))
arma22 <- ts(arma22)
arma22
```

## Arima.sim

```{r}
# ARMA(2,2) dengan fungsi arima.sim
set.seed(1037)
arma22_sim <- arima.sim(list(order=c(2,0,2), ar=c(0.5,0.2), ma=c(0.6,0.4)), n=300)
arma22_sim
```

## Plot Time Series

```{r}
plot(arma22, main="Simulasi ARMA(2,2) manual", ylab="Y_t")
```

## Plot ACF

```{r}
acf(arma22)
```

## Plot PACF

```{r}
pacf(arma22)
```

## Plot EACF

```{r}
TSA::eacf(arma22)
```

## Scatterplot Antar Lag

### Korelasi antara Yt dengan Y(t-1)

```{r}
yt_arma <- arma22[-1]
yt_1_arma <- arma22[-300]
plot(y=yt_arma, x=yt_1_arma, main="Scatterplot Yt-1 vs Yt",col="blue",xlab="Yt-1",ylab="Yt")
```

### Korelasi antara Yt dengan Y(t-2)

```{r}
yt_arma2 <- arma22[-c(1,2)]
yt_2_arma <- arma22[-c(299,300)]
plot(y=yt_arma2, x=yt_2_arma, main="Scatterplot Yt-2 vs Yt",col="blue",xlab="Yt-2",ylab="Yt")
```

### Korelasi antara Yt dengan Y(t-3)

```{r}
yt_arma3 <- arma22[-c(1,2,3)]
yt_3_arma <- arma22[-c(288,299,300)]
plot(y=yt_arma3, x=yt_3_arma, main="Scatterplot Yt-3 vs Yt",col="blue",xlab="Yt-3",ylab="Yt")
```

## Autokorelasi Data vs Teoritis

```{r}
cor(yt_arma,yt_1_arma)
```

```{r}
cor(yt_arma2,yt_2_arma)
```

```{r}
cor(yt_arma3,yt_3_arma)
```

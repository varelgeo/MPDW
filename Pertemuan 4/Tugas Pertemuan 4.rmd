---
title: "Tugas Pertemuan 4 MPDW"
author: "Varel Geo S.P"
date: "2025-09-22"
output:
  rmdformats::readthedown:
    highlight: kate
    number_sections: true
---

# LOAD LIBRARY

```{r}
library("forecast")
library("graphics")
library("TTR")
library("TSA")
library("aTSA")
library("lmtest")
library("MLmetrics")
library("car")
library("dplyr")
library("MASS")
library("tsibble")
library("tseries")
library("ggplot2")
library("nortest")
```

```{r}
library("readxl")
library("dplyr")
```

```{r}
library("dLagM")
```

```{r}
library(orcutt) #untuk membuat model regresi Cochrane-Orcutt
library(HoRM)
```

```{r}
library(MLmetrics) #untuk menghitung MAPE
library(dynlm)
library(lmtest)
```

# PROSES MA(2)

## Manual

```{r}
set.seed(1037)           # reproducibility
n <- 300                 # panjang data
white <- rnorm(n)  # white noise
```

```{r}
# MA(2) Manual
ma<-white[c(1,2)]

for(i in 3:300){
  ma[i]<-white[i]+0.4*white[i-1]+0.6*white[i-2]
}
ma <- ts(ma)
ma
```

## Arima.sim
```{r}
set.seed(1037)
ma2 <- arima.sim(list(order = c(0,0,2), ma = c(0.4, 0.6)), n = 300)
ma2
```

## Plot Time Series

```{r}
plot(ma, main="Simulasi MA(2) manual", ylab="Y_t")
```
Grafik menunjukkan fluktuasi acak di sekitar mean ≈ 0. Tidak ada tren naik/turun jangka panjang → data terlihat stasioner. Varians relatif konstan dari awal hingga akhi
## Plot ACF

```{r}
acf(ma)
```
ACF menunjukkan cut-off pada lag ke-2, setelah itu nilai korelasi turun mendekati nol.Pola ini khas untuk proses MA(2): autokorelasi hanya signifikan sampai lag ke-2, lalu terputus. Hal ini menguatkan bahwa data memang berasal dari proses MA(2).

## Plot PACF

```{r}
pacf(ma)
```
PACF menunjukkan banyak lag dengan nilai kecil dan cepat menurun, tidak ada cut-off yang jelas. Pola ini sesuai dengan proses MA, karena pada MA(q) biasanya PACF tidak terputus secara tajam (bisa menyerupai “tailing off”). Artinya PACF bukan indikator utama untuk orde MA, tapi mendukung bahwa ini bukan AR murni (karena tidak ada cut-off jelas pada PACF awal).
## Plot EACF

```{r}
TSA::eacf(ma)
```
Berdasarkan pola segitiga nol pada plot EACF, terlihat bahwa segitiga nol berada pada ordo AR(0) dan ordo MA(2).
## Scatter Plot Antar Lag

### Korelasi antara Yt dengan Y(t-1)

```{r}
#Yt
yt_ma <- ma[-1]
#Yt-1
yt_1_ma <- ma[-300]
plot(y=yt_ma,x=yt_1_ma)
```

```{r}
#Arimasim
#Yt
yt_mas <- ma2[-1]
#Yt-1
yt_1_mas <- ma2[-300]
plot(y=yt_mas,x=yt_1_mas)
```


### Korelasi antara Yt dengan Y(t-2)

```{r}
#Yt
yt_ma2 <- ma[-c(1,2)]
yt_2_ma <- ma[-c(299,300)]
plot(y=yt_ma2,x=yt_2_ma)
```


```{r}
#Arimasim
yt_ma2s <- ma2[-c(1,2)]
yt_2_mas <- ma2[-c(299,300)]
plot(y=yt_ma2s,x=yt_2_mas)
```
### Korelasi antara Yt dengan Y(t-3)

```{r}
#Yt
yt_ma3 <- ma[-c(1,2,3)]
yt_3_ma <- ma[-c(298,299,300)]
plot(y=yt_ma3,x=yt_3_ma)
```

```{r}
#Yt Arimasim
yt_ma3s <- ma2[-c(1,2,3)]
yt_3_mas <- ma2[-c(298,299,300)]
plot(y=yt_ma3s,x=yt_3_mas)
```
## Aukokorelasi Data vs Teoritis

```{r}
cor(yt_ma,yt_1_ma)
```

```{r}
cor(yt_ma2,yt_2_ma)
```

```{r}
cor(yt_ma3,yt_3_ma)
```

```{r}
cor(yt_mas,yt_1_mas)
```

```{r}
cor(yt_ma2s,yt_2_mas)
```

```{r}
cor(yt_ma3s,yt_3_mas)
```

$$
\rho_1 = \frac{-\theta_1 + \theta_1 \theta_2}{1 + (-\theta_1)^2 + (-\theta_2)^2}
= \frac{-(-0.4) + (-0.4)(-0.6)}{1 + (-0.4)^2 + (-0.6)^2} \approx 0.421
$$

$$
\rho_2 = \frac{-\theta_2}{1 + (-\theta_1)^2 + (-\theta_2)^2}
= \frac{-(-0.6)}{1 + (-0.4)^2 + (-0.6)^2} \approx 0.395
$$

$$
\rho_k = 0, \quad k > 2
$$
Ketiga nilai autokorelasi baik yang dihitung dari data maupun nilai teoritis menunjukkan hasil yang cukup mirip, yaitu pada lag 1 sekitar 0.42, lag 2 sekitar 0.39, dan lag 3 mendekati 0.

# PROSES AR(2)

## Manual

```{r}
set.seed(1037)
# AR(2) Manual
ar2<-numeric(300)
ar2[c(1,2)]<-1

for(i in 3:300){
  ar2[i]<-0.5*ar2[i-1]+0.2*ar2[i-2]+white[i]
}
ar2
```

## Arima.sim

```{r}
set.seed(1037)
ar2_sim <- arima.sim(list(order=c(2,0,0), ar=c(0.5, 0.2)), n=300)
ar2_sim
```

## Plot Time Series

```{r}
ts.plot(ar2)
```
Data berfluktuasi di sekitar mean ≈ 0. Tidak ada tren naik/turun jangka panjang  data stasioner. Ada indikasi bahwa nilai sekarang dipengaruhi nilai sebelumnya (ada “clustering” naik/turun) sesuai karakter AR
## Plot ACF

```{r}
acf(ar2)
```
ACF menurun secara bertahap (tailing off), tidak cut-off pada lag tertentu.Pola ini khas untuk model AR(p). Penurunan terlihat cukup lambat, yang cocok dengan AR(2).
## Plot PACF

```{r}
pacf(ar2)
```
PACF menunjukkan cut-off yang jelas pada lag ke-2. Setelah lag ke-2, semua nilai PACF tidak signifikan (dalam batas kepercayaan). Pola ini khas untuk model AR(2), karena PACF berhenti pada lag p.
## Plot EACF

```{r}
eacf(ar2)
```
Berdasarkan pola segitiga nol pada plot EACF, terlihat bahwa segitiga nol muncul pada ordo AR(2). Hal ini mendukung bahwa data mengikuti proses AR(2).

## Scatter Plot Antar Lag

### Korelasi antara Yt dengan Y(t-1)

```{r}
#Yt
yt_ar <- ar2[-1]
#Yt-1
yt_1_ar <- ar2[-300]
plot(y=yt_ar,x=yt_1_ar)
```

### Korelasi antara Yt dengan Y(t-2)

```{r}
#Yt
yt_ar2 <- ar2[-c(1,2)]
#Yt-2
yt_2_ar <- ar2[-c(299,300)]
plot(y=yt_ar2,x=yt_2_ar)
```

### Korelasi antara Yt deengan Y(t-3)

```{r}
#Yt
yt_ar3 <- ar2[-c(1,2,3)]
#Yt-3
yt_3_ar <- ar2[-c(298,299,300)]
plot(y=yt_ar3,x=yt_3_ar)
```

## Autokorelasi Data vs Teoritis

```{r}
cor(yt_ar,yt_1_ar)
```

```{r}
cor(yt_ar2,yt_2_ar)
```

```{r}
cor(yt_ar3,yt_3_ar)
```

Berikut adalah perhitungan autokorelasi:

$$
\rho_1 = \frac{\phi_1}{1-\phi_2} = \frac{0.5}{1-0.2} = 0.625
$$

$$
\rho_2 = \phi_1 \rho_1 + \phi_2 \rho_0 
= \frac{\phi_1^2 + \phi_2 (1-\phi_2)}{1-\phi_2}
= \frac{(0.5)^2 + 0.2(1-0.2)}{1-0.2} = 0.5125
$$

$$
\rho_3 = \phi_1 \rho_2 + \phi_2 \rho_1 + \phi_3 \rho_0 
= (0.5)(0.5125) + (0.2)(0.625) = 0.38125
$$
Ketiga nilai autokorelasi baik yang dihitung dari data maupun nilai teoritis menunjukkan hasil yang cukup mirip, yaitu pada lag 1 sekitar 0.625, lag 2 sekitar 0.5125, dan lag 3 sekitar 0.38125. Iterasi ini akan terus berlanjut pada lag-lag berikutnya dengan nilai yang akan sangat mendekati 0.

# PROSES ARMA (2,2)

## Manual

```{r}
# ARMA(2,2) Manual
set.seed(1037)
arma.sim <- function(n, macoef, arcoef){
  manum <- length(macoef)
  arnum <- length(arcoef)
  stopifnot(manum < n & arnum < n)
  
  wn <- rnorm(n, sd = 1)
  init <- max(manum, arnum)

  arma <- wn[1:init]
  for(i in {init+1}:n){
   mastart <- i - manum
   maend <- i-1
   arstart <- i - arnum
   arend <- i-1
   arma[i] <- sum(arcoef * arma[arstart:arend]) + sum(macoef * wn[mastart:maend])  + wn[i]
   }
  return(arma)
}
arma22 <- arma.sim(300, c(0.4,0.6), c(0.5,0.2))
arma22 <- ts(arma22)
arma22
```

## Arima.sim

```{r}
# ARMA(2,2) dengan fungsi arima.sim
set.seed(1037)
arma22_sim <- arima.sim(list(order=c(2,0,2), ar=c(0.5,0.2), ma=c(0.6,0.4)), n=300)
arma22_sim
```

## Plot Time Series

```{r}
plot(arma22, main="Simulasi ARMA(2,2) manual", ylab="Y_t")
```
Pola data terlihat acak tapi tetap fluktuatif di sekitar mean nol, yang sesuai dengan karakteristik proses ARMA. Tidak ada tren jangka panjang, artinya model sudah stasioner.
## Plot ACF

```{r}
acf(arma22)
```
ACF menurun secara bertahap (tailing off).Tidak langsung terputus (cut-off), melainkan mengecil perlahan. Ini sesuai dengan perilaku model AR (p).
## Plot PACF

```{r}
pacf(arma22)
```
PACF signifikan pada lag awal (khususnya lag 1 dan 2), lalu mendekati nol setelah itu.Pola ini menunjukkan adanya komponen AR(2). Karena ada juga komponen MA(2), PACF tidak sepenuhnya cut-off, tapi dominan di awal.
## Plot EACF

```{r}
TSA::eacf(arma22)
```
Pada baris AR = 2 dan kolom MA = 2 terlihat mulai terbentuk blok o ke kanan bawah. Artinya model ARMA(2,2) kembali muncul sebagai kandidat kuat. Ada juga kemungkinan lain di sekitar (2,3) atau (3,2), tapi pola paling rapi tetap di (2,2).

## Scatterplot Antar Lag

### Korelasi antara Yt dengan Y(t-1)

```{r}
yt_arma <- arma22[-1]
yt_1_arma <- arma22[-300]
plot(y=yt_arma, x=yt_1_arma, main="Scatterplot Yt-1 vs Yt",col="blue",xlab="Yt-1",ylab="Yt")
```

### Korelasi antara Yt dengan Y(t-2)

```{r}
yt_arma2 <- arma22[-c(1,2)]
yt_2_arma <- arma22[-c(299,300)]
plot(y=yt_arma2, x=yt_2_arma, main="Scatterplot Yt-2 vs Yt",col="blue",xlab="Yt-2",ylab="Yt")
```

### Korelasi antara Yt dengan Y(t-3)

```{r}
yt_arma3 <- arma22[-c(1,2,3)]
yt_3_arma <- arma22[-c(288,299,300)]
plot(y=yt_arma3, x=yt_3_arma, main="Scatterplot Yt-3 vs Yt",col="blue",xlab="Yt-3",ylab="Yt")
```

## Autokorelasi Data vs Teoritis

```{r}
cor(yt_arma,yt_1_arma)
```

```{r}
cor(yt_arma2,yt_2_arma)
```

```{r}
cor(yt_arma3,yt_3_arma)
```
```{r}
# Fungsi untuk menghitung ACF teoretis ARMA(2,2)
arma22_acf <- function(phi, theta, sigma2 = 1, N = 200, maxlag = 10) {

  if(length(phi) != 2 || length(theta) != 2) stop("phi and theta must be length-2 vectors")
  phi1 <- phi[1]; phi2 <- phi[2]
  theta1 <- theta[1]; theta2 <- theta[2]
  
  ar_roots <- polyroot(c(1, -phi1, -phi2))
  if(any(Mod(ar_roots) <= 1)) {
    warning("AR polynomial has a root inside or on unit circle: model may be non-stationary")
  }
  
  psi <- numeric(N + 1)
  psi[1] <- 1                      
  if (N >= 1) psi[2] <- phi1 * psi[1] + theta1       
  if (N >= 2) psi[3] <- phi1 * psi[2] + phi2 * psi[1] + theta2  
  if (N >= 3) {
    for(j in 4:(N+1)) {     
      psi[j] <- phi1 * psi[j-1] + phi2 * psi[j-2]
    }
  }
  
  gamma_k <- function(k) {
    Jmax <- N - k
    s <- sum( psi[1:(Jmax+1)] * psi[(1+k):(Jmax+1+k)] )
    return(sigma2 * s)
  }
  
  gamma_vals <- sapply(0:maxlag, gamma_k)
  rho_vals <- gamma_vals / gamma_vals[1]
  names(rho_vals) <- paste0("rho", 0:maxlag)
  return(list(psi = psi, gamma = gamma_vals, rho = rho_vals))
}

phi <- c(0.5, 0.2)
theta <- c(0.4, 0.6)
res <- arma22_acf(phi = phi, theta = theta, sigma2 = 1, N = 300, maxlag = 3)


round(res$rho, 6)
```

